# 更新日志 (CHANGELOG)

所有对 Proxifier Toggler 的重要更改都将记录在此文件中。

## [2.3.3] - 2026-01-18

### 项目结构

#### 完整的模块化架构
```
easy-proxifier-toggle/
├── src/                      # 源代码目录
│   ├── __init__.py          # 包初始化 (v2.3.3)
│   ├── main.py              # 主程序入口
│   ├── core/                # 核心功能模块
│   │   ├── service.py       # Windows 服务管理
│   │   └── process.py       # 进程管理
│   ├── gui/                 # GUI 相关模块
│   │   ├── tray_icon.py     # 系统托盘图标 (动态状态切换)
│   │   ├── settings.py      # 主控面板 (Toplevel 架构)
│   │   ├── styles.py        # Fluent UI 样式系统
│   │   └── widgets/         # 模块化组件
│   │       ├── status_frame.py    # 状态监控面板
│   │       ├── config_frame.py    # 配置管理面板
│   │       ├── startup_frame.py   # 启动设置面板
│   │       ├── header_frame.py    # 页眉组件
│   │       ├── footer_frame.py    # 页脚组件
│   │       └── about_dialog.py    # 关于对话框
│   ├── config/              # 配置管理模块
│   │   └── manager.py       # 配置文件管理器
│   └── utils/               # 工具函数
│       ├── admin.py         # 管理员权限管理
│       └── startup.py       # 开机自启动管理
├── assets/                  # 资源文件
│   ├── icon.png             # 活动状态图标 (蓝色)
│   ├── icon.ico             # 活动状态图标 (ICO)
│   ├── icon_inactive.png    # 非活动状态图标 (灰色)
│   ├── icon_inactive.ico    # 非活动状态图标 (ICO)
│   └── gzgg-logo.gif        # 应用 Logo
├── config/                  # 配置文件目录
│   └── config.json          # 用户配置 (自动生成)
├── docs/                    # 文档目录
│   ├── CHANGELOG.md         # 更新日志
│   ├── CONFIG.md            # 配置说明
│   ├── QUICKSTART.md        # 快速开始
│   ├── USAGE.md             # 使用指南 (v2.3.3)
│   ├── DEVELOPMENT.md       # 开发指南
│   ├── RESTRUCTURE.md       # 重构说明
│   ├── ADMIN_PERMISSION_UPDATE.md  # 权限管理说明
│   └── TESTING_DYNAMIC_ICON.md     # 动态图标测试指南
├── scripts/                 # 脚本工具
│   ├── build.bat            # 打包脚本
│   ├── update_version.py    # 版本更新工具
│   └── regen_inactive_ico.py  # 图标生成工具
├── run.py                   # 启动脚本
├── start_admin.bat          # 管理员启动脚本
└── requirements.txt         # 依赖列表
```

### 核心功能特性

#### 1. 智能托盘图标系统
- **动态状态指示**: 托盘图标根据 Proxifier 服务状态实时切换
  - 🔵 蓝色图标 - 服务运行中
  - ⚪ 灰色图标 - 服务已停止
- **资源优化**: 按需更新机制，无后台轮询，最大程度节省系统资源
- **图标缓存**: 预加载并缓存图标文件，提升响应速度
- **备用方案**: 图标文件缺失时自动使用代码生成的备用图标

#### 2. Win11 Fluent UI 设计系统
- **现代化视觉语言**:
  - 圆角设计 (8px/12px)
  - 多层次阴影效果 (Elevation)
  - 和谐的配色方案 (HSL 色彩系统)
- **卡片式布局**: 功能模块按卡片组织，层次分明
- **交互反馈**:
  - 平滑的悬停渐变效果
  - 按钮点击缩放动画
  - 状态徽章动态颜色切换
- **自定义滚动条**: 6px 宽度的极简滚动条

#### 3. 模块化组件架构
- **状态监控面板** (`StatusFrame`):
  - 实时显示服务和进程状态
  - 异步监控线程 (每 2 秒刷新)
  - 一键切换功能
  - 状态徽章动态着色
  - 加载动画效果
- **配置管理面板** (`ConfigFrame`):
  - Proxifier 路径配置
  - 服务名称设置
  - 文件浏览器集成
- **启动设置面板** (`StartupFrame`):
  - 开机自启动开关
  - 启动最小化选项
- **关于对话框** (`AboutDialog`):
  - 版本信息展示
  - GitHub 链接跳转
  - 作者信息

#### 4. 线程安全架构
- **Toplevel 窗口架构**: 主控面板使用 `Toplevel` 而非 `Tk`，避免线程冲突
- **主线程 UI 更新**: 所有 UI 操作通过 `after()` 在主线程执行
- **后台任务隔离**: 托盘图标和状态监控在独立线程运行
- **资源生命周期管理**: 窗口关闭时正确清理 Tkinter 变量和组件

#### 5. 配置管理系统
- **持久化存储**: JSON 格式配置文件
- **自动创建**: 首次运行自动生成默认配置
- **热更新**: 配置修改后立即生效，无需重启
- **开机自启动**: 通过注册表实现 Windows 开机自启动

#### 6. 权限管理
- **自动 UAC 提权**: 程序启动时自动弹出 UAC 对话框
- **开发模式**: `--dev` 参数跳过权限检查，便于调试
- **安全退出**: 妥善处理权限提升后的进程重启

### 技术亮点

#### 性能优化
- ✅ 图标预加载与缓存机制
- ✅ 按需刷新，无无效轮询
- ✅ 异步任务处理，UI 不阻塞
- ✅ 资源懒加载

#### 稳定性保障
- ✅ 线程安全的 UI 更新
- ✅ 异常捕获与降级处理
- ✅ 组件生命周期管理
- ✅ 单例模式防止重复实例

#### 用户体验
- ✅ 响应式交互动画
- ✅ 实时状态反馈
- ✅ 友好的错误提示
- ✅ 一键操作设计

### 文档体系

- 📖 **README.md** - 项目说明和快速开始
- 📖 **CHANGELOG.md** - 详细的版本更新记录
- 📖 **CONFIG.md** - 配置文件说明
- 📖 **QUICKSTART.md** - 快速启动指南
- 📖 **USAGE.md** - 详细使用指南
- 📖 **DEVELOPMENT.md** - 开发者文档
- 📖 **PROJECT_SUMMARY.md** - 项目总结

### 版本信息
- **版本号**: 2.3.3
- **发布日期**: 2026-01-18
- **Python 版本**: 3.8+
- **依赖**: pystray, Pillow
- **平台**: Windows

## [2.3.2] - 2026-01-18

### 新增
- **动态托盘图标**: 托盘图标现在会根据 Proxifier 服务状态自动切换颜色。
  - 服务运行时显示蓝色图标
  - 服务停止时显示灰色图标
  - 每 2 秒自动检测状态并更新图标
- **全新圆形图标**: 采用圆形设计，透明背景，带有开关元素的现代化图标。

### 优化
- 图标加载机制优化，使用预生成的 PNG/ICO 文件，提升性能。
- 移除了运行时的图像处理逻辑，减少 CPU 占用。

## [2.3.1] - 2026-01-18

### 修复
- **线程模型重构**: 彻底重构了多线程逻辑，解决了 `RuntimeError: main thread is not in main loop` 错误。
- **稳定性提升**: 修复了多次打开/关闭设置窗口导致的白屏或崩溃问题。
- **资源管理**: 优化了 Tkinter 变量和组件的生命周期管理，防止资源泄露。

## [2.3.0] - 2026-01-18

### 新增
- **Win11 Fluent UI 视觉设计**: 全面升级界面美学，采用 Windows 11 风格的圆角、阴影和层级感设计。
- **现代化交互**: 增加了精细的悬停动画、按下效果以及平滑过渡。
- **UI 布局优化**: 重定义了设置界面的卡片式布局，增加内边距和间距，使信息展示更清晰。
- **自定义滚动条**: 实现了极简现代化的 slim 滚动条。
- **圆角控件**: 对输入框、按钮、卡片等所有交互组件进行了微圆角处理 (8px/12px)。

### 修复
- 修复了设置界面各部分高度不均的问题。
- 优化了主界面在不同缩放下的布局表现。

## [2.2.0] - 2026-01-18

### 重构
- **GUI 模块化**: 对主控面板进行了深度重构，将界面拆分为独立的 `widgets` 组件（状态面板、配置面板、启动面板）。
- **代码优化**: 显著降低了单个文件的代码长度，提高了配置管理与 UI 之间的解耦程度。
- **状态监控**: 优化了异步监控线程，确保在关闭窗口时能平滑停止。

### 新增
- **主控台功能**: 在设置界面集成了开关切换功能，无需右键托盘即可完成操作。
- **重置功能**: 增加了配置重置按钮。

## [2.1.1] - 2026-01-18

### 新增
- **资源目录**: 增加了 `assets/` 文件夹用于存放外部资源。
- **自定义图标支持**: 托盘和设置窗口现在优先从 `assets/` 目录加载图标（支持 PNG 和 ICO）。
- **全新视觉设计**: 采用了极简主义的蓝色渐变 "P" 图标，并完整去除了背景实现透明化，视觉效果更协调。

### 修复
- 修复了图标在某些分辨率下边缘不平滑的问题。

## [2.1.0] - 2026-01-18

### 新增
- **开机自动启动**: 在设置界面可开启/关闭 Windows 开机自启动。
- **启动模式设置**: 可配置启动时是最小化到托盘还是直接打开设置界面。
- **版本号显示**: 设置界面底部和托盘图标提示文字中现在会显示版本号。
- **窗口管理**: 设置窗口现在会始终在屏幕中央显示。
- **便捷启动脚本**: 新增 `start_admin.bat`，可自动请求管理员权限并启动程序。

### 修改
- **权限管理简化**: 移除了复杂的交互式权限选择，改为自动请求 UAC 提权，并支持 `--dev` 开发模式跳过检查。
- **UI 优化**: 调整了设置窗口布局，增加了分隔线和分组。
- **项目结构**: 彻底完成工程化目录重构，分为 `src/core`, `src/gui`, `src/config`, `src/utils`。

### 修复
- 修复了设置窗口可能会在屏幕角落显示的偏移问题。
- 修复了配置保存时可能无法同步开机启动状态的问题。

---

## [2.0.0] - 2026-01-18

### 重构
- **工程化结构**: 将单文件脚本重构为模块化项目。
- **统一入口**: 引入 `run.py` 启动脚本。
- **配置系统**: 引入 `config_manager` 实现配置持久化。
- **GUI 设置**: 引入独立线程的设置窗口。

---

## [1.0.0] - 2026-01-17

### 初始版本
- 实现 Proxifier 服务和进程的基本切换逻辑。
- 系统托盘菜单控制。
- 简单的状态检查。
