# Proxifier Toggler 使用指南 (v2.3.3)

## 基础运行

### 1. 环境准备
确保已安装 Python 3.8+ 并安装依赖：
```bash
pip install -r requirements.txt
```

### 2. 启动方式
推荐使用以下命令启动：
```bash
python run.py
```
程序会自动检测管理员权限。如果当前不是管理员，它会尝试重启并弹出 Windows UAC 授权窗口。

---

## 运行参数详解

### 🚀 正常启动 (`python run.py`)
- **自动提权**：自动请求管理员权限。
- **后台驻留**：启动后最小化到系统托盘。
- **完整功能**：支持启动/停止 Windows 服务和进程。

### 🔧 开发模式 (`python run.py --dev`)
- **跳过提权**：不弹出 UAC 窗口。
- **实时日志**：在控制台显示详细运行日志。
- **界面调试**：适合修改 UI 样式时快速预览。
- **注意**：由于缺乏权限，服务控制逻辑会跳过实际执行。

---

## 界面与交互

### Win11 Fluent UI 体验
版本 2.3.0 引入了全新的视觉语言：
- **卡片式布局**：设置项按功能模块（路径配置、启动设置、版本信息）分组显示。
- **现代化控件**：圆角按钮 (8px)、精致的阴影效果 (Elevation)。
- **交互反馈**：按钮具有平滑的悬停渐变和点击缩放感。
- **滚动优化**：窄边框美化滚动条，自适应内容长度。

### 托盘菜单
- **切换状态**：单点击或菜单选择，自动执行“强制关闭进程 + 停止服务”或“启动服务 + 启动进程”。
- **状态面板**：显示当前 Proxifier 是处于“运行中”还是“已停止”。
- **设置中心**：双击托盘或菜单进入，支持路径浏览、开机启动切换、启动最小化切换。

---

## 进阶配置 (`config.json`)

配置文件位于 `config/config.json`（首次运行自动生成）。

| 配置项 | 说明 | 默认值 |
| :--- | :--- | :--- |
| `proxifier_exe_path` | Proxifier 安装路径 | 需要用户指定 |
| `service_name` | 驱动服务名 | `proxifierdrv` |
| `auto_start` | 开机自启动 | `false` |
| `start_minimized` | 启动时最小化 | `true` |

---

## 故障排查

### UAC 频繁弹出
这是正常现象，因为修改 Windows 系统服务（`net start/stop`）必须具备管理员权限。

### 无法开机自启动
- 请确保在程序设置中开启了该选项。
- 检查杀毒软件是否拦截了启动项修改。
- 程序的开机启动是通过注册表实现的。

### 修改设置后无效
设置在点击“保存”时会立即写入文件并生效，无需手动重启程序。

---

## 开发者说明
项目采用模块化结构：
- `src/core`: 底层逻辑（进程与服务控制）
- `src/gui`: 界面组件（托盘、设置窗口、样式定义）
- `src/config`: 配置读写管理
- `src/utils`: 通用工具（单实例检测、权限检查）
